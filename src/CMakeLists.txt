cmake_minimum_required(VERSION 3.13)
enable_testing()

add_compile_definitions(PROJECT_VERSION="${CMAKE_PROJECT_VERSION}")
file(GLOB sources "./*.cpp")
if (CMAKE_SYSTEM_NAME STREQUAL "Windows")
    set(exe_type "WIN32")
else()
    set(exe_type "")
endif()
add_executable("${CMAKE_PROJECT_NAME}" ${exe_type} ${sources})
set_property(TARGET "${CMAKE_PROJECT_NAME}" PROPERTY CXX_STANDARD 17)
if (CMAKE_SYSTEM_NAME STREQUAL "Linux")
    target_link_libraries("${CMAKE_PROJECT_NAME}" GL GLEW pthread)
elseif (CMAKE_SYSTEM_NAME STREQUAL "Windows")
    target_link_libraries("${CMAKE_PROJECT_NAME}" win_resource opengl32 glew32)
    file(TO_CMAKE_PATH "$ENV{VCToolsInstallDir}" bin_dir)
    set(bin_dir "${bin_dir}/lib/x64")
    install(FILES "${bin_dir}/SDL2.dll" DESTINATION "bin")
    install(FILES "${bin_dir}/SDL2_ttf.dll" DESTINATION "bin")
    install(FILES "${bin_dir}/zlib1.dll" DESTINATION "bin")
    install(FILES "${bin_dir}/libfreetype-6.dll" DESTINATION "bin")
    install(FILES "${bin_dir}/glew32.dll" DESTINATION "bin")
endif()
target_link_libraries("${CMAKE_PROJECT_NAME}" resource SDL2main SDL2)
install(TARGETS "${CMAKE_PROJECT_NAME}" DESTINATION "bin")
